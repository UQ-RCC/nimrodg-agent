language: nix
nix: 2.3.7
os: linux
dist: bionic

cache:
  directories:
    - /nix/store

script:
  - |
    nix-build \
      --argstr gitHash $(git rev-parse HEAD) \
      --argstr gitDescribe $(git describe)   \
      -A release \
      release.nix

# See https://github.com/travis-ci/travis-ci/issues/8667
install: true

deploy:
  provider: releases
  token:
    secure: i8N3nZYFzW3NzLH9ay0Y3fjy/y9+o20Jzokf7+A7OWnXFfqJYHDs5TKStWG3H68rFqlIru1CnF/veGtwq7zHeJHJD8zq3jw0CvEjmmVK0hWleoVys3G3p2MU+a4XLxJD+KxYQ4QhSj6lv2hcXXMWdE4C5uEBus03q338lz5uMfCrBhwiUpTWyAYhner4FQrykxOgOXzPMCOR1Bm0nikEXrgm8wrhqg3izo0Pz+C4LaXNtX981jtBMBMt9+vB5ONkzBuVAO8E0Vvcb5Wus4b3KdDoWSh25lhagkS3UAihAgs+95PHmdORiwso3r2KsDEfoekTWV6ZMEQZjiwoRKHXW6Nj1MZmjPTlfDXvnXOckeW4upujdo+NC4X1zPLFXWcJWiKGt9zQsfzjTS05e7xERdFLtYHkASHSDpr5Z044r+iCBDzKP+Wzhz9mNFgUrQkKTzayLlHlvZjTUr5bmyokyH7S6Kd8j/x7usEj/RadYfGQ9cRiQOTkgVJT/KqMXwABblz6bqxjTJwvqQa23ExnbblL3sODSiQUGvC228woUIs1B8CRnl8eVCnwHGDU/lppTEJjWHWHG/0blsTIpUr+v+p0T2NKcMWvRhMcA1jiEtMZ4EhwTxQ8H4AspDPnWeLz45FWQh7h2e4O7hmTJqOQku72jcumoTYTwBbHu/qU74g=
  file_glob: true
  file:
    - result/*
  on:
    tags: true
  cleanup: false
  # Until dplv2
  skip_cleanup: true

notifications:
  slack:
    rooms:
      - secure: R2BQd8K8KknyQ4K5j4QYa10gzMFs5AGBlE14D7mCzvMg1LF5Kr392ogjhwESdBAy2XPJupRlUTV27pCQWvbjgtzUSjf+sk66sgWgfIzvK76DPQS872Cy9BYmGhqQfy5VgWNdFeDmoFjXj/omeE0n8asKzon74Gb0ZxV777v3uq6/pZK0CSXFz01KcDfM239/kNXvXnBJKrjKXrqrpv8AYYbJqolf7bifJuzDkhxCTXz0AWfIltIZNHXGD9vOkEBtDKGQPTV3D1KjkWmqpHSiOnep2biJBQn8+QKGlT/1TY8QUHCUNUyxJTUb5YeZFgN2+YpYKFbd+4aKCTXH+R8HdkQZkoexZNfEh81gL8QC6q631dslJM+GF5dlvdeOTmo/0p2yLNb6BsWHjrf0ZHVVaQzTbIEaGj8fBUT9EQ09to+70d6Hsy7z4Vbb2PEPLvXXUDuAozraYtbeakHNf2o/7gJy50ab+Iwi/3fQZLmltGwQyNak+AHF96iw93SsprOQ+cwH3xZg9+3apwA+UEUgQbrmD9SmxEwthOoptTXSC20TpuetsI0CP+CwTF+XmK4vRGaEY1eP/w9KFyEfB3jzn0Y1sXYotpdhCyx3v1wWNegcRMoRAnLDxX47k5L0tJGJOsKynkOZGBldVwCaiRqlmJQUWmqBVBAdJ9Ul4gYE7/0=
    on_success: always
    on_failure: always
